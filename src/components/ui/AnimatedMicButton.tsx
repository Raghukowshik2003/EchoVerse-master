 // src/components/ui/AnimatedMicButton.tsx
 import React from 'react';
 import styled, { css } from 'styled-components';

 // Ensure you have this file: src/react-augmentation.d.ts
 // with the following content:
 /*
 import 'react';

 declare module 'react' {
   interface CSSProperties {
     [key: `--${string}`]: string | number | undefined;
   }
 }
 */

 interface AnimatedMicButtonProps {
   isListening: boolean;
   onClick: () => void;
   className?: string; // Allow passing additional classes if needed
 }

 const AnimatedMicButton: React.FC<AnimatedMicButtonProps> = ({ isListening, onClick, className }) => {
   return (
     // StyledWrapper now directly wraps the center-mic
     <StyledWrapper isListening={isListening} className={className}>
       <div className="center-mic"> {/* This is now the top-level element inside StyledWrapper */}
         <div className="mic-inner-1">
           <div className="mic-inner-shadow" />
           <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
             {/* Paths using --n (ensure full paths are included in your actual file) */}
             <path style={{ '--n': 0 }} d="m 30.453794,9.3312954 -7.917031,3.5592496 8.075484,-2.250199 -7.806103,2.917861 8.557307,-1.823038 -8.01593,2.507185 8.032066,-1.895797 -7.983357,2.191854 8.253646,-0.977637 -8.734005,1.906681 L 32,14.873112 l -9.067975,0.906608 8.710099,0.266304 -8.198337,0.552543 7.954998,1.087624 -8.270359,-0.982046 8.279219,2.090895 -8.390625,-1.414284 8.181494,2.680253 -8.493537,-2.051535 8.574554,3.155482 -8.388715,-2.417975 7.336077,3.764862 -7.570347,-3.119239 7.237398,3.832637 -7.562214,-3.356722 6.916716,4.528063 -7.329944,-4.38842 7.092427,5.335096 -7.522317,-4.887511 6.814077,5.918297 -6.887962,-5.110619 5.521649,5.616634 -6.233909,-5.767836 5.503403,6.751906 -5.491939,-6.372858 4.625472,7.39895 -5.068521,-6.684095 4.000882,6.969487 -4.68072,-7.079913 4.067284,7.979967 -4.48828,-7.327749 3.010363,8.041865 -3.735533,-8.032202 2.503054,8.57713 -2.902357,-8.203242 2.094285,8.20334 -2.684607,-8.291976 1.06104,8.716643 -1.776125,-8.125127 0.548536,8.299855 -0.813624,-8.416399 -0.2412,8.255522 L 16.20771,23.125726 15.4421,31.701845 15.242929,23.498523 14.064558,32 l 0.587277,-8.835274 -1.775082,8.37072 1.697587,-8.093671 -3.170898,7.927081 2.584123,-8.084272 -3.20426,7.480536 2.254814,-7.96847 -3.8887271,7.853878 3.2403521,-8.19436 L 8.5610877,29.9216 12.517886,22.497285 7.5507089,29.379668 12.046198,21.750364 6.5947523,28.570304 11.055889,21.326265 5.4426979,28.097163 10.629019,21.028054 4.4997068,26.94961 10.731633,20.566843 3.5132226,25.764534 10.220303,20.149972 3.2927557,24.739834 9.9810583,19.654045 2.25673,23.960218 9.8652404,19.451429 1.8038025,23.025827 9.1046796,19.305047 1.0291963,21.555247 8.8352996,18.637383 0.90505552,20.950147 8.9559849,17.953237 0.9246021,19.240753 8.907278,17.657181 0.65431136,18.026538 8.7262532,16.78565 0.5308521,17.051216 8.7100981,16.473386 0,15.541286 8.824018,15.881794 0.17195626,14.6181 9.1037086,14.950552 0.23447998,13.458068 8.6244205,14.814837 0.40791848,12.550588 8.9364745,14.259836 1.0246568,11.088151 9.341318,13.573511 1.641235,10.168207 9.6112694,13.161477 1.7015879,9.1318812 9.971778,12.327072 2.3821045,7.6182529 9.6879205,11.86392 3.2459742,6.8826274 10.117137,11.432536 4.2522803,5.6193205 10.888769,10.858447 4.6941645,5.0610563 10.938973,10.41757 5.3889774,4.4354757 11.553884,10.397012 6.2911485,3.1246138 12.033296,9.9732614 7.3230861,2.4581945 12.666552,9.595625 8.6349575,1.9229662 13.051856,9.3018977 9.4508097,1.2088495 13.185675,9.2572544 10.683277,1.2559984 14.212019,9.2256532 12.117736,1.0223135 14.17597,8.9557988 13.079224,0.52392743 14.989847,9.1493007 14.342518,0.06442887 15.21856,8.9010195 15.757805,0.26553656 16.219363,8.5761175 16.984975,0 16.522093,8.9428382 18.228047,0.68063187 16.978697,8.7763882 19.415853,0.47938802 17.718936,9.2226522 20.227761,0.55605524 18.269339,9.0150209 21.474281,0.92620575 18.557405,9.5604719 22.481131,1.8826641 19.503145,9.4634767 23.73152,2.0932348 19.774712,10.109628 24.706197,2.9199374 20.257986,9.8369465 25.662155,3.7293008 20.549857,10.562019 26.849902,4.5097482 21.012419,11.167536 27.793574,5.049022 21.500486,11.014131 28.082307,5.9267906 22.083214,11.453541 29.000529,7.258799 22.251749,11.984448 29.3388,8.3969033 22.438949,12.80168 Z" />
             <path style={{ '--n': 1 }} d="m 30.453793,9.3312946 -7.379422,3.9093264 7.537876,-2.600275 -7.490748,3.237121 8.241953,-2.142297 -7.99031,2.273372 8.006444,-1.661985 -7.955063,2.485942 8.225354,-1.271727 -7.970524,1.864419 L 32,14.873113 l -8.601716,0.959229 8.243839,0.213681 -8.358544,0.701137 8.115207,0.939031 -8.169214,-0.992584 8.178073,2.101431 -8.398486,-1.226648 8.189356,2.492618 -7.877865,-1.717096 7.958882,2.821045 -8.438835,-2.295481 7.386196,3.642365 -7.732135,-3.465143 7.399186,4.178542 -7.210149,-3.220847 6.564652,4.392188 -7.056173,-4.39828 6.818655,5.344957 -7.39766,-4.432765 6.689421,5.46355 -6.950195,-5.20626 5.583881,5.712275 -5.785283,-5.457589 5.054777,6.441661 -5.85722,-5.657406 4.990754,6.683497 -5.359548,-6.485015 4.291909,6.770407 -4.760695,-6.910397 4.147258,7.81045 -4.130991,-7.443657 2.653074,8.157773 -3.567761,-7.534991 2.335282,8.079919 -2.996487,-8.357988 2.188417,8.358086 -2.342499,-8.216387 0.718932,8.641054 -1.325609,-8.427327 0.09801,8.602055 -0.589257,-8.490095 -0.465568,8.329218 -0.09939,-8.516258 -0.692376,8.444775 L 15.241545,23.40283 14.064566,32 l 0.723764,-8.472728 -1.911565,8.008174 1.572399,-7.961069 -3.045711,7.794479 2.304556,-7.926397 -2.924692,7.32266 L 13.19445,22.825142 9.1493995,30.650528 12.321633,22.543174 8.5610957,29.9216 11.861045,22.130779 7.5507169,29.379667 11.564823,21.923059 6.5947595,28.570303 11.346629,22.017006 5.4427059,28.097163 10.768039,21.518085 4.4997142,26.94961 10.093201,21.089088 3.5132261,25.764533 10.022836,20.431489 3.2927582,24.739833 9.7046643,20.290122 2.2567321,23.960218 9.439992,19.81075 1.8038046,23.025827 9.2298196,19.012487 1.0291984,21.555245 9.1826921,18.375641 0.90505768,20.950147 8.9303676,18.187049 0.92460428,19.240752 8.8432943,17.72158 0.65431343,18.026537 8.6248358,16.827917 0.53085218,17.051216 8.2438402,16.420765 0,15.541286 8.3578641,15.448431 0.17195627,14.6181 8.411871,14.836186 0.23447997,13.458068 8.8596403,14.429658 0.40791851,12.550588 8.9478474,14.267685 1.0246568,11.088151 8.8014278,13.383633 1.641235,10.168207 9.1473686,13.206409 1.701588,9.1318811 9.8470688,12.659453 2.3821045,7.6182528 10.075542,11.889982 3.2459746,6.8826274 9.9574732,11.393796 4.2522803,5.6193205 10.253257,10.7205 4.6941647,5.0610562 11.152415,10.773123 5.3889781,4.4354755 11.292793,9.9888662 6.2911484,3.1246138 11.662257,9.7741812 7.3230857,2.4581944 12.120151,9.7334145 8.6349582,1.9229662 12.694565,9.4178057 9.4508104,1.2088496 13.018571,9.409638 10.683278,1.2559983 l 2.924447,7.833296 -1.48999,-8.0669808 2.377507,7.8003803 -1.416018,-8.29876641 2.157858,7.90328491 -0.894564,-8.36278341 1.349428,8.55179621 0.06585,-8.3506885 0.4991,8.5377279 L 16.984967,0 16.785841,8.3512631 18.228046,0.68063194 17.504953,8.4713583 19.41585,0.47938807 17.77275,8.5491566 20.227759,0.55605525 18.585277,9.2219696 21.47428,0.92620578 19.098155,9.1159721 l 3.382975,-7.233308 -3.207914,7.8737664 4.458303,-7.663196 -3.962023,7.7171013 4.936701,-6.8903984 -4.628883,6.818034 5.58484,-6.0086706 -4.705286,6.3755622 5.89303,-5.5951148 -5.314429,6.1677578 6.258102,-5.628484 -6.245329,6.057482 6.534063,-5.1797135 -5.836644,5.5875205 6.754866,-4.2555122 -6.437376,5.0051612 6.775648,-3.8670571 -6.475284,3.9879381 z" />
             <path style={{ '--n': 2 }} d="m 30.541226,9.2296057 -7.938903,3.7037263 8.174886,-2.657086 -7.831094,3.499963 7.995399,-2.519247 -8.115428,2.838869 8.832469,-1.317704 -8.11965,1.914742 8.353009,-1.05363 -8.871699,1.90226 8.519451,-0.368294 -8.541924,0.543663 8.733696,0.237197 L 23.47264,16.586221 32,17.632336 23.080451,16.970038 31.747867,18.523632 23.48422,17.3099 l 7.826509,2.4204 -8.253149,-1.822109 7.704114,2.991447 -7.597204,-2.035845 7.22087,3.560254 -7.642189,-3.649918 7.241849,4.868228 -7.755414,-3.782626 7.394199,4.843093 -7.297969,-4.435901 6.68055,5.122677 -7.00115,-4.536489 5.874691,5.51557 -6.209905,-5.527401 5.678979,6.695859 -6.619,-6.103574 5.731823,6.935832 -5.87463,-6.53121 4.515992,7.254421 -5.222812,-6.828951 4.36215,7.116681 -4.570155,-6.992608 3.501229,7.743935 -4.077672,-7.217695 2.770442,7.991228 -3.094358,-7.78858 2.069909,8.03246 -2.624536,-7.991331 1.733342,8.366639 -2.585659,-8.248535 1.243074,8.02132 L 17.196202,23.215077 17.000374,32 l -0.885375,-8.662194 -0.07395,8.316938 -0.08136,-8.344642 -1.414312,8.577102 0.333945,-9.006764 -1.278108,8.838148 0.937465,-8.453892 -2.280277,8.192914 2.163273,-8.237363 -3.090317,7.709648 2.464665,-8.057325 -3.526094,7.757517 2.572652,-8.317624 -3.8450188,7.71981 L 12.22987,22.320748 7.8550504,29.303941 12.042783,21.788694 6.9927342,29.142174 11.335911,21.691793 5.5970307,27.907672 11.156818,21.133527 4.7434577,26.974079 10.879256,20.733452 4.1392639,26.33921 10.507659,20.371824 3.6743562,25.354877 10.185441,20.071133 2.9835374,24.441076 9.5813099,19.503983 1.9200595,23.529032 9.7302349,18.792676 1.4809353,22.180166 9.3071634,18.79336 1.124359,21.041914 9.3776827,18.364576 0.5363378,20.247658 8.9502894,17.568025 0.72462664,18.399009 8.6527176,16.797255 0.43436248,17.593369 8.9229264,16.662068 0,16.245367 8.6963472,15.667827 0.41595654,15.157028 8.6736053,15.288438 0.42572249,13.987926 8.8173384,14.44096 0.6210497,12.426206 8.7930668,13.997018 0.59982387,11.41679 8.9706105,13.6767 1.389339,10.237566 9.6425111,13.396201 1.623431,9.474208 9.8142584,12.495063 2.1541093,8.2179354 10.005234,11.890448 2.6797138,6.985635 10.284683,11.697575 3.7522868,6.3559222 10.280851,11.077716 4.2674896,5.176106 10.882958,10.443581 5.4762221,4.1101236 11.460483,10.251641 6.2678196,3.258197 11.903531,10.322083 7.2290875,2.8969682 12.538022,10.007405 8.580711,2.2011761 12.960951,9.5662682 9.4376128,1.4751301 13.061957,9.4093061 10.786497,1.3857793 13.53776,9.253635 11.712122,0.73336915 14.205504,8.8383942 12.865362,0.27250061 15.13419,8.83552 14.060737,0.44879769 15.512634,8.8465431 15.744302,0.12179054 15.930539,8.8331838 16.875515,0.35483056 16.749574,8.3630169 17.797186,0 17.128844,8.7836269 19.326955,0.72002484 17.922672,8.7984206 20.481014,0.59519911 17.962741,8.9865093 21.108322,0.99799222 19.066456,9.2952349 22.458952,1.2963812 19.239271,9.7072595 23.353115,1.8177175 19.6271,9.8693789 24.70589,2.4615297 20.597518,10.235011 26.003355,3.5217932 20.741892,10.499443 26.533553,4.5542716 21.284983,10.52186 27.744224,4.8252212 21.295076,11.404945 28.297281,6.1580638 21.956694,11.279401 29.372674,7.0992498 22.237907,12.217413 29.936225,7.9444023 22.4654,12.310798 Z" />
           </svg>
           <div className="mic-inner-2" onClick={onClick}>
             <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
               <defs>
                 <linearGradient y2={1} x2="0.35" id="mic-gradient">
                   <stop stopColor="#dfc2f7" offset="0%" />
                   <stop stopColor="#aba7ed" offset="100%" />
                 </linearGradient>
               </defs>
               <path d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z" />
             </svg>
           </div>
           {/* Voice bars using --n and --m */}
           <div style={{ '--n': 1, height: '4.5em' }} className="voice" />
           <div style={{ '--n': 2, height: '3.5em' }} className="voice" />
           <div style={{ '--n': 3, height: '2em' }} className="voice" />
           <div style={{ '--n': 4, height: '1em' }} className="voice" />
           <div style={{ '--n': 5, height: '0.5em' }} className="voice" />
           <div style={{ '--n': -1, '--m': 1, height: '4.5em' }} className="voice" />
           <div style={{ '--n': -2, '--m': 2, height: '3.5em' }} className="voice" />
           <div style={{ '--n': -3, '--m': 3, height: '2em' }} className="voice" />
           <div style={{ '--n': -4, '--m': 4, height: '1em' }} className="voice" />
           <div style={{ '--n': -5, '--m': 5, height: '0.5em' }} className="voice" />
         </div>
       </div>
     </StyledWrapper>
   );
 }

 // StyledWrapper without card styles, includes fix for ::before
 const StyledWrapper = styled.div<{ isListening: boolean }>`
   display: inline-block; /* Or block, depending on layout needs */
   position: relative; /* Needed for absolute positioning of children */
   width: 8rem; /* Set wrapper size to match center-mic */
   height: 8rem; /* Set wrapper size to match center-mic */
   /* background: #333; */ /* TEMPORARY: Uncomment to test visibility */

   .center-mic {
     width: 100%; /* Take full width of wrapper */
     height: 100%; /* Take full height of wrapper */
     border-radius: 50%;
     box-shadow: 0 0 2rem 0rem #7244ff55; /* Outer glow */
     padding: 1px; /* Optional: small padding */
     position: relative; /* Keep relative for children */
     isolation: isolate; /* Keeps pseudo-elements contained */
     transition: 1s 0.5s all;
     overflow: hidden; /* Ensures pseudo-elements clip to the circle */
   }

   /* This was the background layer from the original code */
   /* Removing z-index: -1 to ensure it's visible */
   .center-mic::before {
     content: "";
     position: absolute;
     width: 100%; /* Match parent */
     height: 100%; /* Match parent */
     top: 0;
     left: 0;
     border-radius: 50%;
     background: linear-gradient(-40deg, #fff, #ccc, #fff);
     /* z-index: -1; */ /* REMOVED - Might place it behind the wrapper */
     transition: 1s 0.5s all;
     opacity: 1; /* Ensure it's visible by default */
   }

   .mic-inner-1 {
     position: relative; /* Ensure it's a positioning context */
     width: 100%;
     height: 100%;
     border-radius: 50%;
     /* No background needed here directly if ::before handles it */
   }

   /* This is the inner gradient background layer */
   .mic-inner-1::before {
     content: "";
     position: absolute;
     inset: 0; /* Fill mic-inner-1 */
     border-radius: 50%;
     background: linear-gradient(-40deg, #e8e8f9, #d8cee8);
     transition: 1s 0.5s all;
     opacity: 1; /* Ensure it's visible by default */
   }

   /* The rotating SVG paths */
   .mic-inner-1 > svg {
     fill: #fff; /* Color of the rotating paths */
     position: absolute;
     width: 93%; /* Slightly smaller than container */
     top: 50%;
     left: 50%;
     translate: -50% -50%;
     transition: 1s all;
     opacity: 1; /* Ensure it's visible by default */
     z-index: 1; /* Place above ::before elements */
   }

   .mic-inner-1 > svg path {
     animation:
       5s calc(var(--n, 0) / 3 * 5s) path-opacity linear infinite,
       calc(30s + var(--n, 0) * 2s) rotate infinite linear;
     transform-origin: 50%;
     /* Opacity is handled by animation */
   }

   @keyframes path-opacity {
     0% { opacity: 1; }
     38% { opacity: 0; }
     62% { opacity: 0; }
     to { opacity: 1; }
   }
   @keyframes rotate {
     0% { rotate: 0deg; }
     to { rotate: 360deg; }
   }

   /* The inner shadow creating depth */
   .mic-inner-shadow {
     content: "";
     position: absolute;
     width: 60%;
     height: 60%;
     top: 50%;
     left: 50%;
     translate: -50% -50%;
     border-radius: 50%;
     box-shadow: /* Inner glow */
       0 1rem 1.2rem -0.5rem #95a6ff,
       0 -0.5rem 1.2rem -0.5rem #ffa595;
     transition: 1s 0.5s all;
     opacity: 1; /* Ensure it's visible by default */
     z-index: 2; /* Place above SVG paths */
   }

   /* The clickable mic button itself */
   .mic-inner-2 {
     position: absolute;
     width: 60%;
     height: 60%;
     top: 50%;
     left: 50%;
     translate: -50% -50%;
     border-radius: 99em;
     background: linear-gradient(#ae8bcc, #8c8bcc);
     box-shadow: /* Mic button shadow/highlight */
       inset 0 0 1rem 0 #fffa,
       0 0 0.5rem 0.35rem #fff;
     transition: 0.2s all;
     cursor: pointer;
     display: flex;
     align-items: center;
     justify-content: center;
     z-index: 3; /* Place on top */
     opacity: 1; /* Ensure it's visible by default */
   }

   .mic-inner-2:active {
     box-shadow:
       inset 0 0 1rem 0 #7774,
       0 0 0.5rem 0.35rem #fff;
   }

   .mic-inner-2 > svg { /* The mic icon */
     width: 2.5rem;
     fill: url(#mic-gradient);
     transition: 0.5s all;
     opacity: 1; /* Ensure it's visible by default */
   }

   /* The voice bars (initially hidden) */
   .voice {
     position: absolute;
     width: 0.5rem;
     top: 50%;
     left: 50%;
     translate: -50% -50%;
     transform: translateX(calc(var(--n, 0) * 1em));
     border-radius: 99em;
     background: linear-gradient(#ae8bcc, #8c8bcc);
     box-shadow: inset 0 0 1rem 0 #fffa;
     opacity: 0; /* Hidden by default */
     --m: var(--n); /* CSS variable assignment */
     transition: 0.1s calc(var(--m, 0) * 0.03s) all;
     cursor: pointer; /* Inherits click from parent? Or clickable itself? */
     z-index: 4; /* Place on top when visible */
   }

   /* --- Conditional Styles based on isListening prop --- */
   ${({ isListening }) => isListening && css`
     .center-mic {
       box-shadow: 0 0 2rem 0 #7244ff00; /* Fade outer glow */
       /* transition: 0.5s all; */ /* Already has transition */
     }

     /* Fade out background layers and rotating SVG */
     .mic-inner-1::before,
     .center-mic::before,
     .mic-inner-1 > svg {
       opacity: 0;
       /* transition: 0.5s all; */ /* Already has transition */
     }

     /* Fade out inner shadow */
     .mic-inner-shadow {
       box-shadow:
         0 1rem 1.2rem -0.5rem #95a6ff00,
         0 -0.5rem 1.2rem -0.5rem #ffa59500;
       opacity: 0; /* Also fade opacity */
       /* transition: 0.5s all; */ /* Already has transition */
     }

     /* Fade out mic icon */
     .mic-inner-2 > svg {
       opacity: 0;
       /* transition: 0.5s all; */ /* Already has transition */
     }

     /* Keep .mic-inner-2 visible as the base for voice bars */
     .mic-inner-2 {
        /* Optionally change background/shadow when listening */
        /* background: transparent; */
        /* box-shadow: none; */
     }

     /* Show voice bars */
     .voice {
       opacity: 1;
       transition: 0.5s calc(var(--m, 0) * 0.075s + 0.4s) all; /* Staggered fade-in */
     }
   `}
 `;

 export default AnimatedMicButton;
